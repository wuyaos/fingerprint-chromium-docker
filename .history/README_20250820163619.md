# 基于Docker的fingerprint-chromium浏览器容器

本项目提供基于Alpine的Docker镜像，集成以下功能：
- fingerprint-chromium (adryfish/fingerprint-chromium) 具备隐身指纹特性
- Xvfb + x11vnc + noVNC 实现实时Web界面查看
- Chrome DevTools Protocol 远程调试端口9222，支持DrissionPage连接
- 中国本地化：默认Asia/Shanghai时区、zh-CN语言、CJK字体支持

## 功能特性

- 远程调试：9222端口暴露
- VNC/noVNC：通过Web界面6081端口或VNC 5901端口实时查看浏览器
- Alpine基础镜像 + glibc兼容层
- 无硬编码敏感信息，通过环境变量配置
- 基于/json/version的健康检查

## 快速开始

本地构建：

```bash
docker build -t yourname/fingerprint-chromium-drission:latest .
```

运行容器：

```bash
docker run --rm -p 9222:9222 -p 6081:6081 -e VNC_PASSWORD=changeme \
  -e FINGERPRINT_SEED=2025 -e FINGERPRINT_PLATFORM=linux \
  -e FINGERPRINT_BRAND=Chrome -e BROWSER_LANG=zh-CN -e ACCEPT_LANG=zh-CN,zh \
  --name fpc yourname/fingerprint-chromium-drission:latest
```

在浏览器中打开noVNC界面：
- <http://localhost:6081>
  - 如有提示，使用VNC_PASSWORD指定的密码

验证远程调试：
- <http://localhost:9222/json/version> 应返回JSON数据

## Use with DrissionPage

Example Python snippet to attach via CDP:

```python
from DrissionPage import Chromium

# Connect to the running container's CDP endpoint
c = Chromium(address='127.0.0.1', port=9222)
# Use as usual, e.g. open a tab
c.goto('https://www.example.com')
print(c.title)
```

You may mount a persistent user data dir to keep profiles:

```bash
docker run -d --name fpc \
  -p 9222:9222 -p 6080:6080 \
  -e VNC_PASSWORD=changeme \
  -v $(pwd)/data:/data \
  yourname/fingerprint-chromium-drission:latest
```

## Configuration

Environment variables:
- REMOTE_DEBUGGING_PORT (default 9222)
- SCREEN_WIDTH (default 1280)
- SCREEN_HEIGHT (default 800)
- SCREEN_DEPTH (default 24)
- VNC_PASSWORD (default changeme)
- FINGERPRINT_SEED (default 1000)
- FINGERPRINT_PLATFORM (linux|windows|macos, default linux)
- FINGERPRINT_BRAND (Chrome|Edge|Opera|Vivaldi or custom, default Chrome)
- FINGERPRINT_BRAND_VERSION (optional)
- BROWSER_LANG (default zh-CN)
- ACCEPT_LANG (default zh-CN,zh)
- TIMEZONE (default Asia/Shanghai)
- PROXY_SERVER (optional, e.g. http://host:port)
- CHROME_EXTRA_ARGS (optional extra flags)

The container runs Chromium with flags:

- --remote-debugging-port=${REMOTE_DEBUGGING_PORT}
- --user-data-dir=/data
- --lang, --accept-lang
- --fingerprint*, and Docker-friendly flags like --no-sandbox

Ports:

- 9222: Chrome DevTools
- 5900: VNC (x11vnc)
- 6080: noVNC (web)

## Security

- No credentials are hardcoded
- Prefer running behind a firewall/reverse proxy when exposing ports on public hosts
- Change VNC_PASSWORD
- Consider limiting access to 9222 using firewall rules

## CI/CD (GitHub Actions)

This repo includes .github/workflows/docker-build.yml that:

- Builds on manual trigger (workflow_dispatch) with configurable fingerprint-chromium version
- Pushes to GHCR and optionally Docker Hub (if DOCKERHUB_* secrets are set)
- Targets linux/amd64
- Provides tags: latest on default branch, git tag, and sha

Required repository secrets for Docker Hub (optional):

- DOCKERHUB_REPO (e.g. docker.io/yourname/fingerprint-chromium-drission)
- DOCKERHUB_USERNAME
- DOCKERHUB_TOKEN

## Healthcheck

Container health is based on <http://127.0.0.1:9222/json/version>.

## Notes

- The fingerprint-chromium Linux artifact is downloaded at build time; update FC_VERSION in Dockerfile to match desired release.
- Alpine uses musl, so we install glibc via sgerrand packages to satisfy Chromium runtime requirements.